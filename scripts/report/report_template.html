<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚ é“å¾®ç”Ÿç‰©æ£€æµ‹æŠ¥å‘Š - {{ sample_id }}</title>
    <link rel="stylesheet" href="report_styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- ============ å¤´éƒ¨ä¿¡æ¯ ============ -->
    <header class="report-header">
        <div class="header-content">
            <h1>ğŸ§¬ è‚ é“å¾®ç”Ÿç‰©æ£€æµ‹æŠ¥å‘Š</h1>
            <div class="header-info">
                <span>æ ·æœ¬ç¼–å·ï¼š{{ sample_id }}</span>
                <span>æ£€æµ‹æ—¥æœŸï¼š{{ report_date }}</span>
            </div>
        </div>
    </header>

    <!-- ============ å¯¼èˆªæ  ============ -->
    <nav class="report-nav">
        <ul>
            <li><a href="#overview">æ€»è§ˆ</a></li>
            <li><a href="#diversity">å¤šæ ·æ€§åˆ†æ</a></li>
            <li><a href="#composition">ç‰©ç§ç»„æˆ</a></li>
            <li><a href="#bacteria">ç»†èŒè¯„ä¼°</a></li>
            <li><a href="#disease">ç–¾ç—…é£é™©</a></li>
            <li><a href="#age">å¹´é¾„é¢„æµ‹</a></li>
            <li><a href="#advice">å¥åº·å»ºè®®</a></li>
        </ul>
    </nav>

    <!-- ============ ä¸»ä½“å†…å®¹ ============ -->
    <main class="report-content">
        
        <!-- æ€»è§ˆéƒ¨åˆ† -->
        <section id="overview" class="report-section">
            <h2>ğŸ“Š æ£€æµ‹æ€»è§ˆ</h2>
            
            <!-- åŸºæœ¬ç»Ÿè®¡ -->
            <div class="info-grid">
                <div class="info-card">
                    <div class="info-label">æ€»readsæ•°</div>
                    <div class="info-value">{{ results.sample_info.total_reads | default(0) }}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">æ€»ASVsæ•°</div>
                    <div class="info-value">{{ results.sample_info.total_asvs | default(0) }}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">è‚ å‹</div>
                    <div class="info-value">{{ results.enterotype.enterotype.type | default('æœªçŸ¥') }}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">å¥åº·è¯„åˆ†</div>
                    <div class="info-value">{{ results.bacteria.overall_health.score | default(0) }}</div>
                </div>
            </div>
            
            <!-- AIç»¼åˆè¯„ä»· -->
            <div class="ai-assessment">
                <h3>ç»¼åˆè¯„ä»·</h3>
                <p>{{ ai_texts.overall_assessment | default('æš‚æ— ç»¼åˆè¯„ä»·') }}</p>
            </div>
        </section>

        <!-- å¤šæ ·æ€§åˆ†æ -->
        <section id="diversity" class="report-section">
            <h2>ğŸŒˆ èŒç¾¤å¤šæ ·æ€§åˆ†æ</h2>
            
            <div class="chart-grid">
                <!-- Alphaå¤šæ ·æ€§æŒ‡æ ‡ -->
                <div class="metric-table">
                    <h3>Alphaå¤šæ ·æ€§æŒ‡æ ‡</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>æŒ‡æ ‡</th>
                                <th>æ•°å€¼</th>
                                <th>çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ShannonæŒ‡æ•°</td>
                                <td>{{ results.diversity.alpha_diversity.shannon | round(3) }}</td>
                                <td class="status-{{ results.diversity.alpha_diversity.status | lower }}">
                                    {{ results.diversity.alpha_diversity.status }}
                                </td>
                            </tr>
                            <tr>
                                <td>SimpsonæŒ‡æ•°</td>
                                <td>{{ results.diversity.alpha_diversity.simpson | round(3) }}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Chao1ä¼°è®¡</td>
                                <td>{{ results.diversity.alpha_diversity.chao1 | round(1) }}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>è§‚å¯Ÿåˆ°çš„ASVs</td>
                                <td>{{ results.diversity.alpha_diversity.observed_asvs }}</td>
                                <td>-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- å¤šæ ·æ€§é›·è¾¾å›¾ -->
                <div class="chart-container">
                    <h3>å¤šæ ·æ€§é›·è¾¾å›¾</h3>
                    <canvas id="diversityRadar"></canvas>
                </div>
            </div>
            
            <!-- B/Fæ¯”å€¼ -->
            <div class="bf-ratio-section">
                <h3>æ‹Ÿæ†èŒé—¨/åšå£èŒé—¨æ¯”å€¼</h3>
                <div class="bf-display">
                    <div class="bf-value">
                        <span class="value">{{ results.diversity.bf_ratio.value | round(2) }}</span>
                        <span class="label">B/Fæ¯”å€¼</span>
                    </div>
                    <div class="bf-status status-{{ results.diversity.bf_ratio.status | lower }}">
                        {{ results.diversity.bf_ratio.status }}
                    </div>
                </div>
                <p class="bf-note">æ­£å¸¸èŒƒå›´ï¼š0.84-4.94</p>
            </div>
        </section>

        <!-- ç‰©ç§ç»„æˆ -->
        <section id="composition" class="report-section">
            <h2>ğŸ¦  ç‰©ç§ç»„æˆåˆ†æ</h2>
            
            <!-- å±æ°´å¹³Top10 -->
            <div class="composition-chart">
                <h3>å±æ°´å¹³ç»„æˆï¼ˆTop 10ï¼‰</h3>
                <canvas id="genusComposition"></canvas>
            </div>
            
            <!-- è‚ å‹åˆ†æ -->
            <div class="enterotype-info">
                <h3>è‚ å‹åˆ†æ</h3>
                <div class="enterotype-card">
                    <div class="enterotype-type">{{ results.enterotype.enterotype.type }}</div>
                    <div class="enterotype-desc">{{ results.enterotype.enterotype.description }}</div>
                    <div class="key-genera">
                        <h4>å…³é”®å±ä¸°åº¦ï¼š</h4>
                        {% for genus, abundance in results.enterotype.enterotype.key_genera_abundance.items() %}
                        <span class="genus-badge">{{ genus }}: {{ abundance }}%</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </section>

        <!-- ç»†èŒè¯„ä¼° -->
        <section id="bacteria" class="report-section">
            <h2>âš–ï¸ ç»†èŒå¥åº·è¯„ä¼°</h2>
            
            <!-- æ•´ä½“å¥åº·è¯„åˆ† -->
            <div class="health-score">
                <div class="score-circle score-{{ results.bacteria.overall_health.score | int // 20 }}">
                    <span class="score-value">{{ results.bacteria.overall_health.score | round(1) }}</span>
                    <span class="score-label">å¥åº·è¯„åˆ†</span>
                </div>
                <div class="score-grade">{{ results.bacteria.overall_health.grade }}</div>
            </div>
            
            <!-- æœ‰ç›ŠèŒåˆ—è¡¨ -->
            <div class="bacteria-list">
                <h3>ğŸŸ¢ æ ¸å¿ƒæœ‰ç›ŠèŒ</h3>
                <div class="bacteria-grid" id="beneficialBacteria"></div>
            </div>
            
            <!-- æœ‰å®³èŒåˆ—è¡¨ -->
            <div class="bacteria-list">
                <h3>ğŸ”´ æ ¸å¿ƒæœ‰å®³èŒ</h3>
                <div class="bacteria-grid" id="harmfulBacteria"></div>
            </div>
            
            <!-- å¼‚å¸¸è§£é‡Šï¼ˆå¦‚æœæœ‰ï¼‰ -->
            {% if ai_texts.abnormal_explanation %}
            <div class="ai-explanation">
                <h3>å¼‚å¸¸æŒ‡æ ‡è§£è¯»</h3>
                <p>{{ ai_texts.abnormal_explanation }}</p>
            </div>
            {% endif %}
        </section>

        <!-- ç–¾ç—…é£é™© -->
        <section id="disease" class="report-section">
            <h2>âš ï¸ ç–¾ç—…é£é™©è¯„ä¼°</h2>
            
            <!-- æ•´ä½“é£é™©çŠ¶æ€ -->
            <div class="risk-overview">
                <div class="risk-status">
                    å¥åº·çŠ¶æ€ï¼š{{ results.disease_risk.overall_risk.health_status }}
                </div>
                <div class="risk-score">
                    å¹³å‡é£é™©åˆ†ï¼š{{ results.disease_risk.overall_risk.average_risk_score | round(1) }}
                </div>
            </div>
            
            <!-- ç–¾ç—…é£é™©å›¾è¡¨ -->
            <div class="chart-container">
                <h3>å„ç–¾ç—…é£é™©è¯„åˆ†</h3>
                <canvas id="diseaseRiskChart"></canvas>
            </div>
            
            <!-- é«˜é£é™©ç–¾ç—…è§£è¯» -->
            {% if ai_texts.disease_interpretation %}
            <div class="ai-explanation">
                <h3>é£é™©è§£è¯»</h3>
                <p>{{ ai_texts.disease_interpretation }}</p>
            </div>
            {% endif %}
            
            <!-- é¢„é˜²å»ºè®® -->
            {% if results.disease_risk.prevention_advice %}
            <div class="prevention-advice">
                <h3>é¢„é˜²å»ºè®®</h3>
                {% for disease, advice in results.disease_risk.prevention_advice.items() %}
                <div class="advice-card">
                    <h4>{{ disease }}</h4>
                    <ul>
                        <li>é¥®é£Ÿï¼š{{ advice.diet }}</li>
                        <li>ç”Ÿæ´»æ–¹å¼ï¼š{{ advice.lifestyle }}</li>
                        <li>è¡¥å……å‰‚ï¼š{{ advice.supplements }}</li>
                    </ul>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </section>

        <!-- ç”Ÿç‰©å¹´é¾„ -->
        <section id="age" class="report-section">
            <h2>â° ç”Ÿç‰©å¹´é¾„é¢„æµ‹</h2>
            
            <div class="age-display">
                <div class="bio-age">
                    <span class="age-value">{{ results.age.age_prediction.biological_age | round(0) }}</span>
                    <span class="age-label">ç”Ÿç‰©å¹´é¾„ï¼ˆå²ï¼‰</span>
                </div>
                
                {% if results.age.age_status %}
                <div class="age-status">
                    <div class="status-type">{{ results.age.age_status.status }}</div>
                    <div class="status-desc">{{ results.age.age_status.description }}</div>
                </div>
                {% endif %}
            </div>
            
            <!-- è¡°è€é€Ÿåº¦ -->
            {% if results.age.aging_rate %}
            <div class="aging-rate">
                <h3>è¡°è€é€Ÿåº¦è¯„ä¼°</h3>
                <div class="rate-level">{{ results.age.aging_rate.rate_level }}</div>
                <div class="rate-desc">{{ results.age.aging_rate.description }}</div>
            </div>
            {% endif %}
        </section>

        <!-- ä¸ªæ€§åŒ–å»ºè®® -->
        <section id="advice" class="report-section">
            <h2>ğŸ’¡ ä¸ªæ€§åŒ–å¥åº·å»ºè®®</h2>
            
            <!-- AIä¸ªæ€§åŒ–å»ºè®® -->
            <div class="personalized-advice">
                {{ ai_texts.personalized_advice | default('æš‚æ— ä¸ªæ€§åŒ–å»ºè®®') | nl2br }}
            </div>
            
            <!-- è‚ å‹ç›¸å…³å»ºè®® -->
            {% if results.enterotype.enterotype_features %}
            <div class="enterotype-advice">
                <h3>åŸºäºè‚ å‹çš„å»ºè®®</h3>
                <ul>
                    <li><strong>é¥®é£Ÿï¼š</strong>{{ results.enterotype.enterotype_features.diet_recommendation }}</li>
                    <li><strong>å¥åº·ï¼š</strong>{{ results.enterotype.enterotype_features.health_implications }}</li>
                </ul>
                <div class="food-recommendations">
                    <div class="food-good">
                        <h4>âœ… æ¨èé£Ÿç‰©</h4>
                        <ul>
                        {% for food in results.enterotype.enterotype_features.beneficial_foods %}
                            <li>{{ food }}</li>
                        {% endfor %}
                        </ul>
                    </div>
                    <div class="food-avoid">
                        <h4>âŒ é¿å…é£Ÿç‰©</h4>
                        <ul>
                        {% for food in results.enterotype.enterotype_features.avoid_foods %}
                            <li>{{ food }}</li>
                        {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            {% endif %}
        </section>

    </main>

    <!-- ============ é¡µè„š ============ -->
    <footer class="report-footer">
        <p>æœ¬æŠ¥å‘ŠåŸºäº16S rRNAæµ‹åºæŠ€æœ¯ï¼Œä»…ä¾›å‚è€ƒã€‚å¦‚æœ‰å¥åº·é—®é¢˜ï¼Œè¯·å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿã€‚</p>
        <p>æŠ¥å‘Šç”Ÿæˆæ—¥æœŸï¼š{{ report_date }}</p>
    </footer>

    <!-- ============ JavaScript ============ -->
    <script src="report_scripts.js"></script>
    <script>
        // ä¼ å…¥å›¾è¡¨æ•°æ®
        const chartsData = {{ charts_data | tojson | safe }};
        const bacteriaData = {{ results.bacteria | tojson | safe }};
        
        // æ¸²æŸ“æ‰€æœ‰å›¾è¡¨å’Œç»„ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            renderAllCharts(chartsData);
            renderBacteriaCards(bacteriaData);
        });
    </script>
</body>
</html>
